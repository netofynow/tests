<html>
  <head>
    <title>Advanced IP Grabber</title>
    <style>
        #ip-grabber {
            position: relative;
            width: 100%;
            height: 100%;
        }
    </style>
  </head>
  <body>
    <div id="ip-grabber">
        <script>
            // Get the IP address of the client
            var ip = "";
            window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;   //compatibility for Firefox and chrome
            var pc = new RTCPeerConnection({iceServers:[]}), noop = function(){};
            pc.createDataChannel("");    //create a bogus data channel
            pc.createOffer(pc.setLocalDescription.bind(pc), noop);    // create offer and set local description
            pc.onicecandidate = function(ice){  //listen for candidate events
                if(!ice || !ice.candidate || !ice.candidate.candidate)  return;
                ip = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];
            };

            // Send the IP address to the server
            var req = new XMLHttpRequest();
            req.open("POST", "/test/ip", true);
            req.send("IP=" + ip);
        </script>
    </div>
  </body>
</html>
